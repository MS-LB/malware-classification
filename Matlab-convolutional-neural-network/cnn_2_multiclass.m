
% Small test dataset
%{
testImds = imageDatastore('/Users/mjscheid/Desktop/478_Project/datasets/grayscale-images/grayscale-tiny-4/test/','IncludeSubFolders',true','LabelSource','foldernames');
valImds =   imageDatastore('/Users/mjscheid/Desktop/478_Project/datasets/grayscale-images/grayscale-tiny-4/val/','IncludeSubFolders',true','LabelSource','foldernames');
trainImds = imageDatastore('/Users/mjscheid/Desktop/478_Project/datasets/grayscale-images/grayscale-tiny-4/train/','IncludeSubFolders',true','LabelSource','foldernames');
%}

% 4 att. dataset

testImds =  imageDatastore('/Users/mjscheid/Desktop/478_Project/datasets/grayscale-images/cnn2-4/test/','IncludeSubFolders',true','LabelSource','foldernames');
valImds =   imageDatastore('/Users/mjscheid/Desktop/478_Project/datasets/grayscale-images/cnn2-4/val/','IncludeSubFolders',true','LabelSource','foldernames');
trainImds = imageDatastore('/Users/mjscheid/Desktop/478_Project/datasets/grayscale-images/cnn2-4/train/','IncludeSubFolders',true','LabelSource','foldernames');


% 8 att. dataset
%{
testImds = imageDatastore('/Users/mjscheid/Desktop/478_Project/datasets/grayscale-images/cnn2-8/test/','IncludeSubFolders',true','LabelSource','foldernames');
valImds = imageDatastore('/Users/mjscheid/Desktop/478_Project/datasets/grayscale-images/cnn2-8/val/','IncludeSubFolders',true','LabelSource','foldernames');
trainImds = imageDatastore('/Users/mjscheid/Desktop/478_Project/datasets/grayscale-images/cnn2-8/train/','IncludeSubFolders',true','LabelSource','foldernames');
%}


inputSize = [16 16 1];
numClasses = 6;

layers = [
    imageInputLayer(inputSize)
    convolution2dLayer(5,20)
    batchNormalizationLayer
    reluLayer
    fullyConnectedLayer(numClasses)
    softmaxLayer
    classificationLayer];


options = trainingOptions('sgdm', ...
    'MaxEpochs',30, ...
    'ValidationData',valImds, ...
    'ValidationFrequency',30, ...
    'Verbose',false, ...
    'Plots','training-progress');

net = trainNetwork(trainImds,layers,options);

YPred = classify(net,testImds);
YTest = testImds.Labels;
accuracy = mean(YPred == YTest);

disp("accuracy");
disp(accuracy);

